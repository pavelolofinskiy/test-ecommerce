<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>Каталог товарів</title>
  <style>
    :root {
      --primary-color: #1d4ed8;
      --gray: #f4f4f4;
      --border: #e0e0e0;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: #fff;
      padding: 30px;
      color: #222;
    }

    h1 {
      margin-bottom: 20px;
      color: var(--primary-color);
    }

    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 25px;
    }

    .filter-group {
      background: var(--gray);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px 16px;
      min-width: 180px;
    }

    .filter-group strong {
      display: block;
      margin-bottom: 10px;
      font-size: 15px;
      color: #333;
    }

    .filter-group label {
      display: block;
      margin-bottom: 6px;
      font-size: 14px;
      cursor: pointer;
    }

    .products {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
    }

    .product {
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 16px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.03);
      transition: transform 0.2s;
    }

    .product:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.06);
    }

    .product h3 {
      margin-top: 0;
      font-size: 18px;
      color: #111;
    }

    .product p {
      font-size: 14px;
      color: #444;
    }

    .pagination {
      margin-top: 30px;
      text-align: center;
    }

    .pagination button {
      padding: 8px 12px;
      margin: 0 4px;
      border: 1px solid var(--primary-color);
      background: #fff;
      color: var(--primary-color);
      border-radius: 5px;
      cursor: pointer;
      transition: 0.2s;
    }

    .pagination button:hover {
      background: var(--primary-color);
      color: #fff;
    }

    .pagination button:disabled {
      background: var(--primary-color);
      color: #fff;
      opacity: 0.7;
      cursor: default;
    }

    .sort-select {
      margin-bottom: 25px;
    }

    .sort-select select {
      padding: 6px 10px;
      font-size: 14px;
      border-radius: 5px;
      border: 1px solid var(--border);
      min-width: 200px;
    }

    .no-products {
      text-align: center;
      font-size: 16px;
      color: #888;
      padding: 40px;
    }

    input[type="checkbox"] {
      margin-right: 6px;
    }
  </style>
</head>
<body>

  <h1>Каталог товарів</h1>

  <div class="filters" id="filters">
    <!-- Фільтри тут будуть динамічно -->
  </div>

  <div class="sort-select">
    Сортування:
    <select id="sortBy">
      <option value="">За замовчуванням</option>
      <option value="price_asc">Ціна: зростання</option>
      <option value="price_desc">Ціна: спадання</option>
    </select>
  </div>

  <div class="products" id="products">
    <!-- Товари тут -->
  </div>

  <div class="pagination" id="pagination">
    <!-- Пагінація -->
  </div>

<script>
  // -------------------------------
  // 1. Глобальні змінні стану
  let currentPage = 1;
  const perPage = 10;
  let activeFilters = {}; // { brand: ['Lenovo', 'HP'], color: ['Black'] }
  let sortBy = '';

  // -------------------------------
  // 2. Функція для завантаження фільтрів з API і рендеру їх
  async function loadFilters() {
    // Формуємо URL з активними фільтрами
    const params = new URLSearchParams();
    for (const key in activeFilters) {
      activeFilters[key].forEach(value => params.append(`filter[${key}][]`, value));
    }

    const res = await fetch(`/api/catalog/filters?${params.toString()}`);
    const data = await res.json();

    const filtersDiv = document.getElementById('filters');
    filtersDiv.innerHTML = ''; // очистити

    data.forEach(filter => {
      const groupDiv = document.createElement('div');
      groupDiv.className = 'filter-group';

      console.log(filter);

      const title = document.createElement('strong');
      title.textContent = filter.name + ': ';
      groupDiv.appendChild(title);

      filter.values.forEach(val => {
        const label = document.createElement('label');
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.value = val.value;
        checkbox.checked = val.active;
        checkbox.dataset.slug = filter.slug;

        checkbox.addEventListener('change', (e) => {
          const slug = e.target.dataset.slug;
          const value = e.target.value;

          if (!activeFilters[slug]) activeFilters[slug] = [];
          if (e.target.checked) {
            if (!activeFilters[slug].includes(value)) {
              activeFilters[slug].push(value);
            }
          } else {
            activeFilters[slug] = activeFilters[slug].filter(v => v !== value);
            if (activeFilters[slug].length === 0) delete activeFilters[slug];
          }

          currentPage = 1;
          loadProducts();
          loadFilters();
        });

        label.appendChild(checkbox);
        label.appendChild(document.createTextNode(` ${val.value} (${val.count})`));
        groupDiv.appendChild(label);
      });

      filtersDiv.appendChild(groupDiv);
    });
  }

  // -------------------------------
  // 3. Функція для завантаження та рендеру товарів
  async function loadProducts() {
    const params = new URLSearchParams();
    params.set('page', currentPage);
    params.set('limit', perPage);
    if (sortBy) params.set('sort_by', sortBy);
    for (const key in activeFilters) {
      activeFilters[key].forEach(value => params.append(`filter[${key}][]`, value));
    }

    const res = await fetch(`/api/catalog/products?${params.toString()}`);
    const json = await res.json();

    const productsDiv = document.getElementById('products');
    productsDiv.innerHTML = '';

    if (json.data.length === 0) {
      productsDiv.textContent = 'Товари не знайдено';
      renderPagination(0, 0);
      return;
    }

    json.data.forEach(product => {
      const div = document.createElement('div');
      div.className = 'product';
      div.innerHTML = `
        <h3>${product.name}</h3>
        <p><b>Ціна:</b> ${product.price} грн</p>
        <p>${product.description}</p>
      `;
      productsDiv.appendChild(div);
    });

    renderPagination(json.meta.current_page, json.meta.last_page);
  }

  // -------------------------------
  // 4. Функція для рендеру пагінації
  function renderPagination(current, last) {
    const paginationDiv = document.getElementById('pagination');
    paginationDiv.innerHTML = '';

    if (last <= 1) return;

    for (let i = 1; i <= last; i++) {
      const btn = document.createElement('button');
      btn.textContent = i;
      if (i === current) {
        btn.disabled = true;
      }
      btn.addEventListener('click', () => {
        currentPage = i;
        loadProducts();
      });
      paginationDiv.appendChild(btn);
    }
  }

  // -------------------------------
  // 5. Обробка сортування
  document.getElementById('sortBy').addEventListener('change', (e) => {
    sortBy = e.target.value;
    currentPage = 1;
    loadProducts();
  });

  // -------------------------------
  // 6. При завантаженні сторінки
  window.onload = async () => {
    await loadFilters();
    await loadProducts();
  };
</script>

</body>
</html>